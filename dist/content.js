const activeURL=window.location.href.toString(),pattern=/sunrun.my.salesforce/,pattern2=/visual.force.com/;let isSalesforcePage=pattern.test(activeURL)||pattern2.test(activeURL);console.log(isSalesforcePage,activeURL),chrome.storage.sync.get("salesforceColor",(e=>{for(key in e)isSalesforcePage&&(document.body.style.backgroundColor=e[key].toString())})),chrome.storage.sync.onChanged.addListener((async e=>{let t=e.salesforceColor;isSalesforcePage&&(document.body.style.backgroundColor=t.newValue.toString())}));let selections=[...document.querySelectorAll("table tbody tr")].map((e=>{const[t]=e.querySelectorAll("th");return{id:t}}));console.log("Extension Loaded"),chrome.runtime.onMessage.addListener(((e,t,d)=>{if("ping"===e.greeting){let t;t=e.currentTab.url.toString().includes("wfproject")?"project":document.getElementsByClassName("pageType")[0].innerText;let i,a,o,l,r,s,n,c=[],v=[],b=!1;const p=document.getElementsByTagName("th");Object.values(p).forEach((e=>{e.innerText.toLowerCase().includes("pr-")&&(b=!0,n=e.innerText)}));const u=document.getElementsByClassName("dataCell");if(Object.values(u).forEach((e=>{e.innerText.includes("PK")&&(c.push(e.innerText),v.push(e.firstChild.href))})),"proposal"===t.toLowerCase()){const e=document.getElementsByClassName("dataCol col02");Object.values(e).forEach((e=>{/0066Q000029/.test(e.firstChild.id)&&(r=e.firstChild.innerText,l=e.firstChild.href)}))}if("project"===t.toLowerCase()){let e=document.getElementsByClassName("lookup-link");l=Object.values(e)[1].href,r=Object.values(e)[1].innerText,s=Object.values(e)[2].href}let y;switch(b?(i=c[0],a=v[0],o=n):(i="",a="",o=""),t.toLowerCase()){case"opportunity":y=['//*[@id="bodyCell"]/div[1]/div[1]/div[1]/h2','//*[@id="ep"]/div[2]/div[11]/table/tbody/tr[1]/td[2]','//*[@id="ep"]/div[2]/div[11]/table/tbody/tr[6]/td[4]'];break;case"service contract":y=['//*[@id="bodyCell"]/div[1]/div[1]/div[1]/h2','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[1]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[1]/td[4]/a','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[2]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[3]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[4]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[5]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[4]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[5]/td[2]'];break;case"project":y=["//*/div/div[1]/div/div/div/div/div[2]/h1","//*/div/table/tbody/tr[2]/td[1]/c-display-fields/div/div/div[2]/div/div/a","//*/div/div/div/div/div[2]/c-wfm-project-details-section/div/div/div[1]/c-display-fields[5]/div/div/div[2]/div/lightning-formatted-rich-text/span"];break;case"proposal":y=['//*[@id="bodyCell"]/div[1]/div[1]/div[1]/h2','//*[@id="ep"]/div[2]/div[15]/table/tbody/tr[1]/td[2]','//*[@id="ep"]/div[2]/div[5]/table/tbody/tr[7]/td[2]'];break;case"user":y=['//*[@id="bodyCell"]/div[1]/div[1]/div[1]/h2','//*[@id="ep"]/div[2]/div[2]/table/tbody/tr[3]/td[4]/a','//*[@id="ep"]/div[2]/div[2]/table/tbody/tr[6]/td[2]','//*[@id="_RelatedPermsetAssignmentList_body"]/table']}let g,m=window.location.href;g="user"===t.toLowerCase()?y.map((e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null))):y.map((e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.innerText));let f=[t,m,g[0],g[1],g[2],o,a],h=[t,m,g[0],g[1],g[2],g[3],g[4],g[5],g[6]],C=[t,s,g[0],g[1],g[2],o,l,r],w=[t,m,g[0],g[1],g[2],o,l,r];switch(t.toLowerCase()){case"opportunity":d({farewell:"pong",data:f});break;case"service contract":d({farewell:"pong",data:h});break;case"project":d({farewell:"pong",data:C});break;case"proposal":d({farewell:"pong",data:w})}}}));